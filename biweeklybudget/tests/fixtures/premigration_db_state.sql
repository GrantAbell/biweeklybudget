SET FOREIGN_KEY_CHECKS=0;
CREATE TABLE `account_balances` (`id` int(11) NOT NULL AUTO_INCREMENT, `account_id` int(11) NOT NULL, `ledger` decimal(10,4) DEFAULT NULL, `ledger_date` datetime DEFAULT NULL, `avail` decimal(10,4) DEFAULT NULL, `avail_date` datetime DEFAULT NULL, `overall_date` datetime DEFAULT NULL, PRIMARY KEY (`id`), KEY `fk_account_balances_account_id_accounts` (`account_id`), CONSTRAINT `fk_account_balances_account_id_accounts` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`) ) ENGINE=InnoDB;
CREATE TABLE `accounts` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(50) DEFAULT NULL, `description` varchar(254) DEFAULT NULL, `ofx_cat_memo_to_name` tinyint(1) DEFAULT NULL, `vault_creds_path` varchar(254) DEFAULT NULL, `ofxgetter_config_json` text, `acct_type` enum('Bank','Credit','Investment','Cash','Other') DEFAULT NULL, `credit_limit` decimal(10,4) DEFAULT NULL, `is_active` tinyint(1) DEFAULT NULL, `re_interest_charge` varchar(254) DEFAULT NULL, `re_interest_paid` varchar(254) DEFAULT NULL, `re_payment` varchar(254) DEFAULT NULL, `re_fee` varchar(254) DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `ix_accounts_name` (`name`) ) ENGINE=InnoDB;
CREATE TABLE `budgets` ( `id` int(11) NOT NULL AUTO_INCREMENT, `is_periodic` tinyint(1) DEFAULT NULL, `name` varchar(50) DEFAULT NULL, `description` varchar(254) DEFAULT NULL, `starting_balance` decimal(10,4) DEFAULT NULL, `current_balance` decimal(10,4) DEFAULT NULL, `is_active` tinyint(1) DEFAULT NULL, `is_income` tinyint(1) DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `ix_budgets_name` (`name`) ) ENGINE=InnoDB;
CREATE TABLE `ofx_statements` ( `id` int(11) NOT NULL AUTO_INCREMENT, `account_id` int(11) NOT NULL, `filename` varchar(254) DEFAULT NULL, `file_mtime` datetime DEFAULT NULL, `currency` varchar(10) DEFAULT NULL, `bankid` varchar(20) DEFAULT NULL, `routing_number` varchar(20) DEFAULT NULL, `acct_type` varchar(32) DEFAULT NULL, `brokerid` varchar(30) DEFAULT NULL, `acctid` varchar(30) DEFAULT NULL, `type` varchar(20) DEFAULT NULL, `as_of` datetime DEFAULT NULL, `ledger_bal` decimal(10,4) DEFAULT NULL, `ledger_bal_as_of` datetime DEFAULT NULL, `avail_bal` decimal(10,4) DEFAULT NULL, `avail_bal_as_of` datetime DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `uq_ofx_statements_account_id` (`account_id`,`filename`), CONSTRAINT `fk_ofx_statements_account_id_accounts` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`) ) ENGINE=InnoDB;
CREATE TABLE `ofx_trans` ( `account_id` int(11) NOT NULL, `statement_id` int(11) NOT NULL, `fitid` varchar(255) NOT NULL, `trans_type` varchar(50) DEFAULT NULL, `date_posted` datetime DEFAULT NULL, `amount` decimal(10,4) DEFAULT NULL, `name` varchar(255) DEFAULT NULL, `memo` varchar(255) DEFAULT NULL, `sic` varchar(255) DEFAULT NULL, `mcc` varchar(255) DEFAULT NULL, `checknum` varchar(32) DEFAULT NULL, `description` varchar(254) DEFAULT NULL, `notes` text, `is_payment` tinyint(1) DEFAULT NULL, `is_late_fee` tinyint(1) DEFAULT NULL, `is_interest_charge` tinyint(1) DEFAULT NULL, `is_other_fee` tinyint(1) DEFAULT NULL, `is_interest_payment` tinyint(1) DEFAULT NULL, `reconcile_id` int(11) DEFAULT NULL, PRIMARY KEY (`account_id`,`fitid`), KEY `ix_ofx_trans_name` (`name`), KEY `ix_ofx_trans_description` (`description`), KEY `ix_ofx_trans_memo` (`memo`), KEY `fk_ofx_trans_reconcile_id_txn_reconciles` (`reconcile_id`), KEY `fk_ofx_trans_statement_id_ofx_statements` (`statement_id`), CONSTRAINT `fk_ofx_trans_account_id_accounts` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`), CONSTRAINT `fk_ofx_trans_reconcile_id_txn_reconciles` FOREIGN KEY (`reconcile_id`) REFERENCES `txn_reconciles` (`id`), CONSTRAINT `fk_ofx_trans_statement_id_ofx_statements` FOREIGN KEY (`statement_id`) REFERENCES `ofx_statements` (`id`)) ENGINE=InnoDB;
CREATE TABLE `reconcile_rules` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(50) DEFAULT NULL, `is_active` tinyint(1) DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `uq_reconcile_rules_name` (`name`) ) ENGINE=InnoDB;
CREATE TABLE `scheduled_transactions` ( `id` int(11) NOT NULL AUTO_INCREMENT, `amount` decimal(10,4) NOT NULL, `description` varchar(254) NOT NULL, `notes` varchar(254) DEFAULT NULL, `account_id` int(11) DEFAULT NULL, `budget_id` int(11) DEFAULT NULL, `is_active` tinyint(1) DEFAULT NULL, `date` date DEFAULT NULL, `day_of_month` smallint(6) DEFAULT NULL, `num_per_period` smallint(6) DEFAULT NULL, PRIMARY KEY (`id`), KEY `ix_scheduled_transactions_description` (`description`), KEY `fk_scheduled_transactions_account_id_accounts` (`account_id`), KEY `fk_scheduled_transactions_budget_id_budgets` (`budget_id`), CONSTRAINT `fk_scheduled_transactions_account_id_accounts` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`), CONSTRAINT `fk_scheduled_transactions_budget_id_budgets` FOREIGN KEY (`budget_id`) REFERENCES `budgets` (`id`) ) ENGINE=InnoDB;
CREATE TABLE `transactions` ( `id` int(11) NOT NULL AUTO_INCREMENT, `date` date DEFAULT NULL, `actual_amount` decimal(10,4) NOT NULL, `budgeted_amount` decimal(10,4) DEFAULT NULL, `description` varchar(254) NOT NULL, `notes` varchar(254) DEFAULT NULL, `account_id` int(11) DEFAULT NULL, `scheduled_trans_id` int(11) DEFAULT NULL, `budget_id` int(11) DEFAULT NULL, PRIMARY KEY (`id`), KEY `ix_transactions_description` (`description`), KEY `fk_transactions_budget_id_budgets` (`budget_id`), KEY `fk_transactions_account_id_accounts` (`account_id`), KEY `fk_transactions_scheduled_trans_id_scheduled_transactions` (`scheduled_trans_id`), CONSTRAINT `fk_transactions_account_id_accounts` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`), CONSTRAINT `fk_transactions_budget_id_budgets` FOREIGN KEY (`budget_id`) REFERENCES `budgets` (`id`), CONSTRAINT `fk_transactions_scheduled_trans_id_scheduled_transactions` FOREIGN KEY (`scheduled_trans_id`) REFERENCES `scheduled_transactions` (`id`) ) ENGINE=InnoDB;
CREATE TABLE `txn_reconciles` ( `id` int(11) NOT NULL AUTO_INCREMENT, `txn_id` int(11) DEFAULT NULL, `ofx_fitid` varchar(255) DEFAULT NULL, `ofx_account_id` int(11) DEFAULT NULL, `rule_id` int(11) DEFAULT NULL, `note` varchar(254) DEFAULT NULL, `reconciled_at` datetime DEFAULT NULL, PRIMARY KEY (`id`), KEY `fk_txn_reconciles_ofx_account_id_ofx_trans` (`ofx_account_id`,`ofx_fitid`), KEY `fk_txn_reconciles_rule_id_reconcile_rules` (`rule_id`), KEY `fk_txn_reconciles_txn_id_transactions` (`txn_id`), CONSTRAINT `fk_txn_reconciles_ofx_account_id_ofx_trans` FOREIGN KEY (`ofx_account_id`, `ofx_fitid`) REFERENCES `ofx_trans` (`account_id`, `fitid`), CONSTRAINT `fk_txn_reconciles_rule_id_reconcile_rules` FOREIGN KEY (`rule_id`) REFERENCES `reconcile_rules` (`id`), CONSTRAINT `fk_txn_reconciles_txn_id_transactions` FOREIGN KEY (`txn_id`) REFERENCES `transactions` (`id`) ) ENGINE=InnoDB;
SET FOREIGN_KEY_CHECKS=1;
